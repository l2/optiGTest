classdef unConstrained < handle
    
    properties
        funName='';
        xMin=[];
        xMax=[];
        dim=0;
        locMinZ
        locMinX
        globMinZ
        globMinX
        Xeval
    end
    
    methods
        function obj=unConstrained(funName,XX,dim)
            addpath('unConstrained/');
            obj.funName=funName;
            obj.dim=loadDim(funName);
            if nargin==1
                obj.demo
            elseif nargin==2
                obj.prepX(XX);
                obj.eval()
            elseif nargin==3
                obj.dim=dim;
                obj.prepX(XX);
                obj.eval()
            end
        end
        %setters
        % function set.funName(obj,txt)
        
        %end
        function prepX(obj,XX)
            sX=[size(XX,1) size(XX,2) size(XX,3)];
            nbvar=sX(3);
            if isinf(obj.dim)
                if nbvar==1
                    obj.Xeval=reshape(XX,[],1,sX(2));
                else
                    obj.Xeval=XX;
                    obj.dim=nbvar;
                end
            else
                if nbvar==obj.dim
                    obj.Xeval=XX;
                elseif nbvar==1
                    if sX(2)==obj.dim
                        obj.Xeval=reshape(XX,[],1,sX(2));
                    else
                        fprintf('Wrong size of sample points\n');
                    end
                else
                    fprintf('Wrong size of sample points\n');
                end
            end
        end
        function [ZZ,GZ]=eval(obj,XX)
            if nargin==1
                [ZZ,GZ]=feval(['fun' obj.funName],obj.Xeval);
            else
                [ZZ,GZ]=feval(['fun' obj.funName],XX);
            end
        end
        function demo(obj)
            if isinf(obj.dim);obj.dim=2;end
            if obj.dim==1
            elseif obj.dim==2||isinf(obj.dim)
                stepM=50;
                [Xmin,Xmax]=loadSpace(obj.funName,obj.dim);
                xL=linspace(Xmin(1),Xmax(1),stepM);
                yL=linspace(Xmin(2),Xmax(2),stepM);
                [x,y]=meshgrid(xL,yL);
                xx=zeros(stepM,stepM,2);
                xx(:,:,1)=x;xx(:,:,2)=y;
                %evaluation of the function
                [ZZ,GZ]=obj.eval(xx);
                %display
                obj.show2D(x,y,ZZ,GZ);
            else
                fprintf('Too large dimension to be plotted');
            end
        end
        function show2D(obj,XX,YY,ZZ,GZ)
            figure
            subplot(1,3,1)
            surf(XX,YY,ZZ);
            axis('tight','square')
            xlabel('x'), ylabel('y'), title(obj.funName)
            subplot(1,3,2)
            surf(XX,YY,GZ(:,:,1));
            axis('tight','square')
            xlabel('x'), ylabel('y'), title(['Grad. X ' obj.funName])
            subplot(1,3,3)
            surf(XX,YY,GZ(:,:,2));
            axis('tight','square')
            xlabel('x'), ylabel('y'), title(['Grad. Y ' obj.funName])
        end
    end
    
end


%load dimension
function dim=loadDim(funName)
listDim=struct(...
    'Brown',Inf,...
    'Bukin1',2,...
    'Bukin2',2,...
    'Bukin3',2,...
    'Bukin4',2,...
    'Bukin5',2,...
    'Bukin6',2,...
    'Bukin7',2,...
    'Bukin8',2,...
    'Bukin9',2,...
    'Bukin10',2,...
    'Bukin11',2,...
    'Bukin12',2,...
    'Bukin13',2,...
    'Bukin14',2,...
    'Bukin15',2,...
    'Bukin16',2,...
    'Bukin17',2,...
    'Bukin18',2,...
    'Bukin19',2,...
    'Bukin20',2);

dim=listDim.(funName);
end

%load global minima
function [GlobX,GlobZ]=loadGlobMin(funName,dim)
listGlobXmin=struct(...
    'Brown',0,...
    'Bukin1',[1,-1;-1,1],...
    'Bukin2',[-10,0],...
    'Bukin3',[-1.5*pi,0],...
    'Bukin4',[-10,0],...
    'Bukin5',[-10,0],...
    'Bukin6',[-10,1],...
    'Bukin7',[-5,5;142.574,-0.17535],...
    'Bukin8',[-20,-20],...
    'Bukin9',[-6,-3],...
    'Bukin10',[-7,-9;-9,-3],...
    'Bukin11',[-5,-5],...
    'Bukin12',[-5,-5],...
    'Bukin13',[-3,0.5],...
    'Bukin14',[-10,-1],...
    'Bukin15',[-10,25;10,-175],...
    'Bukin16',[-5,-5],...
    'Bukin17',[-5,-5;20,-30],...
    'Bukin18',[-5,-5;2.28916,-128.91566],...
    'Bukin19',[9,71;-8,54],...
    'Bukin20',[-2,-1]);
listGlobZmin=struct(...
    'Brown',0,...
    'Bukin1',[0;0],...
    'Bukin2',0,...
    'Bukin3',0,...
    'Bukin4',0,...
    'Bukin5',0,...
    'Bukin6',0,...
    'Bukin7',[0;0],...
    'Bukin8',0,...
    'Bukin9',0,...
    'Bukin10',[0;0],...
    'Bukin11',0,...
    'Bukin12',0,...
    'Bukin13',0,...
    'Bukin14',0,...
    'Bukin15',[0;0],...
    'Bukin16',0,...
    'Bukin17',[0;0],...
    'Bukin18',[0;0],...
    'Bukin19',[0;0],...
    'Bukin20',0);

lGX=listGlobXmin.(funName);
GlobZ=listGlobZmin.(funName);
if size(lGX,2)==1
    GlobX=repmat(lGX,1,dim);
else
    GlobX=lGX;
end
end

%load space definition
function [xMin,xMax]=loadSpace(funName,dim)
listSpace=struct(...
    'Brown',[-1;4],...
    'Bukin1',[-5 -5;5 5],...
    'Bukin2',[-15 -3;-5 3],...
    'Bukin3',[-5 -5;5 5],...
    'Bukin4',[-5 -5;5 5],...
    'Bukin5',[-5 -5;5 5],...
    'Bukin6',[-5 -5;5 5],...
    'Bukin7',[-5 -5;5 5],...
    'Bukin8',[-5 -5;5 5],...
    'Bukin9',[-5 -5;5 5],...
    'Bukin10',[-5 -5;5 5],...
    'Bukin11',[-5 -5;5 5],...
    'Bukin12',[-5 -5;5 5],...
    'Bukin13',[-5 -5;5 5],...
    'Bukin14',[-5 -5;5 5],...
    'Bukin15',[-5 -5;5 5],...
    'Bukin16',[-5 -5;5 5],...
    'Bukin17',[-5 -5;5 5],...
    'Bukin18',[-5 -5;5 5],...
    'Bukin19',[-5 -5;5 5],...
    'Bukin20',[-5 -5;5 5]);

spaceL=listSpace.(funName);
if size(spaceL,2)==1
    xMin=ones(1,dim)*spaceL(1);
    xMax=ones(1,dim)*spaceL(2);
else
    xMin=spaceL(1,:);
    xMax=spaceL(2,:);
end
end


